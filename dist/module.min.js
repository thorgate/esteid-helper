var _=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var T=Object.prototype.hasOwnProperty;var k=(a,e)=>{for(var t in e)_(a,t,{get:e[t],enumerable:!0})},N=(a,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of R(e))!T.call(a,i)&&i!==t&&_(a,i,{get:()=>e[i],enumerable:!(s=A(e,i))||s.enumerable});return a};var U=a=>N(_({},"__esModule",{value:!0}),a);var b={};k(b,{default:()=>L});module.exports=U(b);var o="EST",d="ENG",c="RUS",u="LIT",S=[o,d,c,u],p={user_cancel:{[o]:"Allkirjastamine katkestati",[d]:"Signing was cancelled",[u]:"Pasira\u0161ymas nutrauktas",[c]:"\u041F\u043E\u0434\u043F\u0438\u0441\u044C \u0431\u044B\u043B\u0430 \u043E\u0442\u043C\u0435\u043D\u0435\u043D\u0430"},no_certificates:{[o]:"Sertifikaate ei leitud",[d]:"Certificate not found",[u]:"Nerastas sertifikatas",[c]:"\u0421\u0435\u0440\u0442\u0438\u0444\u0438\u043A\u0430\u0442 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D"},invalid_argument:{[o]:"Vigane sertifikaadi identifikaator",[d]:"Invalid certificate identifier",[u]:"Neteisingas sertifikato identifikatorius",[c]:"\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u0438\u0434\u0435\u043D\u0442\u0438\u0444\u0438\u043A\u0430\u0442\u043E\u0440 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043A\u0430\u0442\u0430"},no_implementation:{[o]:"Vajalik tarkvara on puudu",[d]:"Unable to find software",[u]:"Nerasta programin\u0117s \u012Franga",[c]:"\u041E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E\u0435 \u043F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u043D\u043E\u0435 \u043E\u0431\u0435\u0441\u043F\u0435\u0447\u0435\u043D\u0438\u0435"},version_mismatch:{[o]:"Allkirjastamise tarkvara ja brauseri laienduse versioonid ei \xFChti. Palun uuendage oma id-kaardi tarkvara.",[d]:"The versions of the signing software and browser extension do not match. Please update your ID card software.",[u]:"Parakst\u012B\u0161anas programmas un p\u0101rl\u016Bka papla\u0161in\u0101juma versijas nesakr\u012Bt. L\u016Bdzu, atjauniniet savu ID kartes programmat\u016Bru.",[c]:"\u0412\u0435\u0440\u0441\u0438\u0438 \u043F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u044B \u0434\u043B\u044F \u043F\u043E\u0434\u043F\u0438\u0441\u0430\u043D\u0438\u044F \u0438 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043D\u0438\u044F \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430 \u043D\u0435 \u0441\u043E\u0432\u043F\u0430\u0434\u0430\u044E\u0442. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u0435 \u043F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u043D\u043E\u0435 \u043E\u0431\u0435\u0441\u043F\u0435\u0447\u0435\u043D\u0438\u0435 \u0434\u043B\u044F \u0432\u0430\u0448\u0435\u0439 \u0438\u0434\u0435\u043D\u0442\u0438\u0444\u0438\u043A\u0430\u0446\u0438\u043E\u043D\u043D\u043E\u0439 \u043A\u0430\u0440\u0442\u044B."},technical_error:{[o]:"Tehniline viga",[d]:"Technical error",[u]:"Technin\u0117 klaida",[c]:"\u0422\u0435\u0445\u043D\u0438\u0447\u0435\u0441\u043A\u0430\u044F \u043E\u0448\u0438\u0431\u043A\u0430"},not_allowed:{[o]:"Veebis allkirjastamise k\xE4ivitamine on v\xF5imalik vaid https aadressilt",[d]:"Web signing is allowed only from https:// URL",[u]:"Web signing is allowed only from https:// URL",[c]:"\u041F\u043E\u0434\u043F\u0438\u0441\u044C \u0432 \u0438\u043D\u0442\u0435\u0440\u043D\u0435\u0442\u0435 \u0432\u043E\u0437\u043C\u043E\u0436\u043D\u0430 \u0442\u043E\u043B\u044C\u043A\u043E \u0441 URL-\u043E\u0432, \u043D\u0430\u0447\u0438\u043D\u0430\u044E\u0449\u0438\u0445\u0441\u044F \u0441 https://"}},E=class{constructor(e){this.language=e||o,this.certificate=null,this.supportedSignatureAlgorithms=null,this.signatureAlgorithm=null}initializeIdCard(){return new Promise(function(e,t){typeof window.webeid<"u"?e("web-eid"):typeof window.hwcrypto<"u"&&window.hwcrypto.use("auto")?e("hwcrypto"):t("Backend selection failed")})}getCertificate(){return new Promise((e,t)=>{let s={lang:this.language};window.webeid.getSigningCertificate(s).then(({certificate:i,supportedSignatureAlgorithms:n})=>{this.certificate=i,this.supportedSignatureAlgorithms=n,e(i)},i=>{t(i)})})}signHexData(e,t="SHA-256"){return new Promise((s,i)=>{let n={lang:this.language};window.webeid.sign(this.certificate,e,t,n).then(r=>{this.signatureAlgorithm=r.signatureAlgorithm,s(r.signature)},r=>{i(r)})})}get language(){return this._language}set language(e){S.indexOf(e)!==-1&&(this._language=e)}getWebeidErrorMapping(e){switch((e?e.code:null)||null){case"ERR_WEBEID_CONTEXT_INSECURE":return"not_allowed";case"ERR_WEBEID_ACTION_TIMEOUT":return"technical_error";case"ERR_WEBEID_USER_CANCELLED":case"ERR_WEBEID_USER_TIMEOUT":return"user_cancel";case"ERR_WEBEID_VERSION_MISMATCH":case"ERR_WEBEID_VERSION_INVALID":return"version_mismatch";case"ERR_WEBEID_EXTENSION_UNAVAILABLE":case"ERR_WEBEID_NATIVE_UNAVAILABLE":return"no_implementation";case"ERR_WEBEID_NATIVE_FATAL":return e.message.includes("https")?"not_allowed":"technical_error";default:case"ERR_WEBEID_UNKNOWN_ERROR":case"ERR_WEBEID_NATIVE_INVALID_ARGUMENT":case"ERR_WEBEID_ACTION_PENDING":case"ERR_WEBEID_MISSING_PARAMETER":return"technical_error"}}getError(e){let t;return typeof p[e]>"u"?t=this.getWebeidErrorMapping(e)||"technical_error":t=e,{error_code:t,message:p[t][this.language],raw:e}}},I=E;var g=async(a,e,t="POST")=>{let s={"Content-Type":"application/json"},i=null;t!=="GET"&&(s["X-CSRFToken"]=e.csrfmiddlewaretoken,i=JSON.stringify(e||{}));try{let n=await fetch(a,{method:t,headers:s,body:i}),r=await n.text();try{let l=JSON.parse(r);return l.success=l.status==="success",l.pending=`${n.status}`=="202",{data:l,ok:n.ok}}catch{return console.log("Failed to parse response as JSON",r),{}}}catch(n){return console.log(n),{}}},f=class{constructor({language:e,idUrl:t,mobileIdUrl:s,smartIdUrl:i,csrfToken:n,pollInterval:r}){this.idCardManager=new I(e),this.idUrl=t,this.mobileIdUrl=s,this.smartIdUrl=i,this.csrfToken=n,this.language=e,this.pollInterval=r||3e3}checkStatus(e,t,s){let i=this.pollInterval,n=this.csrfToken,r=()=>{g(e,{csrfmiddlewaretoken:n},"PATCH").then(({ok:l,data:h})=>{l&&h.pending?setTimeout(()=>r(),i):l&&h.success?t(h):s(h)}).catch(l=>{console.log("Status error",l)})};return r()}signWithIdCard(){return new Promise((e,t)=>{this.__signHandleIdCard(e,t)})}signWithMobileId({idCode:e,phoneNumber:t}){return new Promise((s,i)=>{this.__signHandleMid(e,t,s,i)})}signWithSmartId({idCode:e,country:t}){return new Promise((s,i)=>{this.__signHandleSmartid(e,t,s,i)})}__signHandleIdCard(e,t){this.idCardManager.initializeIdCard().then(()=>{this.idCardManager.getCertificate().then(s=>{g(this.idUrl,{csrfmiddlewaretoken:this.csrfToken,certificate:s}).then(({ok:i,data:n})=>{i&&n.success?this.__doSign(n.digest,e,t):t(n)})},t)},t)}__doSign(e,t,s){this.idCardManager.signHexData(e).then(i=>{g(this.idUrl,{csrfmiddlewaretoken:this.csrfToken,signature_value:i},"PATCH").then(({ok:n,data:r})=>{n&&r.success?t(r):s(r)})},s)}__signHandleMid(e,t,s,i){g(this.mobileIdUrl,{id_code:e,phone_number:t,language:this.language,csrfmiddlewaretoken:this.csrfToken}).then(({ok:n,data:r})=>{n&&r.success?s(r):i(r)})}midStatus(){return new Promise((e,t)=>{this.checkStatus(this.mobileIdUrl,e,t)})}__signHandleSmartid(e,t,s,i){g(this.smartIdUrl,{id_code:e,country:t,csrfmiddlewaretoken:this.csrfToken}).then(({ok:n,data:r})=>{n&&r.success?s(r):i(r)})}smartidStatus(){return new Promise((e,t)=>{this.checkStatus(this.smartIdUrl,e,t)})}getError(e){return this.idCardManager.getError(e)}},w=f;var m={IdentificationManager:w,Languages:{ET:o,EN:d,RU:c,LT:u}};var C=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{};C.Esteid=m;var L=m;
